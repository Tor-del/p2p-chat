{"version":3,"sources":["typescript-lib/index.js","types/MessageSenderEnum.ts","components/Chat/Chat.tsx","types/MessageTypeEnum.ts","components/Space/Space.tsx","App.tsx","serviceWorker.js","index.tsx"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","Symbol","iterator","this","n","v","op","TypeError","call","pop","length","push","CHANNEL_LABEL","createPeerConnection","_a","channelInstance","remoteDescription","onChannelOpen","onMessageReceived","peerConnection","RTCPeerConnection","setAnswerDescription","answerDescription","setRemoteDescription","JSON","parse","sendMessage","message","send","onicecandidate","candidate","console","log","stringify","localDescription","ondatachannel","onconnectionstatechange","onicecandidateerror","oniceconnectionstatechange","onicegatheringstatechange","onnegotiationneeded","onsignalingstatechange","onstatsended","ontrack","res","channel","onopen","onmessage","event","data","description","createAnswer","setLocalDescription","createDataChannel","warn","setupDC1","createOffer","MESSAGE_SENDER","MESSAGE_TYPE","InputForm","styled","form","Message","div","sender","ME","css","MessagesWrapper","Wrapper","Chat","messages","React","useState","messageToSend","setMessageToSend","map","key","id","payload","onSubmit","preventDefault","stopPropagation","type","placeholder","onChange","target","Mode","Space","size","App","mode","setMode","isReady","setIsReady","setMessages","setAnswerDescriptionRef","useRef","sendMessageRef","messageString","handleHostBtnClick","a","HOST","current","Base64","encode","handleRemoteDescriptionInputChange","handleSlaveBtnClick","SLAVE","decode","handleLocalDescriptionCopy","copy","textMessages","filter","m","TEXT","Title","style","textAlign","onClick","block","Text","Search","enterButton","onSearch","Math","random","toFixed","STRANGER","Boolean","window","location","hostname","match","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"qVAgBA,SAASA,EAAUC,EAASC,EAAYC,EAAGC,GACvC,OAAO,IAAKD,IAAMA,EAAIE,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUC,GAAS,IAAMC,EAAKN,EAAUO,KAAKF,IAAW,MAAOG,GAAKL,EAAOK,IACpF,SAASC,EAASJ,GAAS,IAAMC,EAAKN,EAAS,MAAUK,IAAW,MAAOG,GAAKL,EAAOK,IACvF,SAASF,EAAKI,GAAUA,EAAOC,KAAOT,EAAQQ,EAAOL,OAAS,IAAIN,GAAE,SAAUG,GAAWA,EAAQQ,EAAOL,UAAWO,KAAKR,EAAWK,GACnIH,GAAMN,EAAYA,EAAUa,MAAMhB,EAASC,GAAc,KAAKS,WAItE,SAASO,EAAYjB,EAASkB,GAC1B,IAAsGC,EAAGC,EAAGC,EAAGC,EAA3GC,EAAI,CAAEC,MAAO,EAAGC,KAAM,WAAa,GAAW,EAAPJ,EAAE,GAAQ,MAAMA,EAAE,GAAI,OAAOA,EAAE,IAAOK,KAAM,GAAIC,IAAK,IAChG,OAAOL,EAAI,CAAEZ,KAAMkB,EAAK,GAAI,MAASA,EAAK,GAAI,OAAUA,EAAK,IAAwB,oBAAXC,SAA0BP,EAAEO,OAAOC,UAAY,WAAa,OAAOC,OAAUT,EACvJ,SAASM,EAAKI,GAAK,OAAO,SAAUC,GAAK,OACzC,SAAcC,GACV,GAAIf,EAAG,MAAM,IAAIgB,UAAU,mCAC3B,KAAOZ,GAAG,IACN,GAAIJ,EAAI,EAAGC,IAAMC,EAAY,EAARa,EAAG,GAASd,EAAC,OAAac,EAAG,GAAKd,EAAC,SAAeC,EAAID,EAAC,SAAeC,EAAEe,KAAKhB,GAAI,GAAKA,EAAEV,SAAWW,EAAIA,EAAEe,KAAKhB,EAAGc,EAAG,KAAKpB,KAAM,OAAOO,EAE3J,OADID,EAAI,EAAGC,IAAGa,EAAK,CAAS,EAARA,EAAG,GAAQb,EAAEb,QACzB0B,EAAG,IACP,KAAK,EAAG,KAAK,EAAGb,EAAIa,EAAI,MACxB,KAAK,EAAc,OAAXX,EAAEC,QAAgB,CAAEhB,MAAO0B,EAAG,GAAIpB,MAAM,GAChD,KAAK,EAAGS,EAAEC,QAASJ,EAAIc,EAAG,GAAIA,EAAK,CAAC,GAAI,SACxC,KAAK,EAAGA,EAAKX,EAAEI,IAAIU,MAAOd,EAAEG,KAAKW,MAAO,SACxC,QACI,KAAkBhB,GAAZA,EAAIE,EAAEG,MAAYY,OAAS,GAAKjB,EAAEA,EAAEiB,OAAS,MAAkB,IAAVJ,EAAG,IAAsB,IAAVA,EAAG,IAAW,CAAEX,EAAI,EAAG,SACjG,GAAc,IAAVW,EAAG,MAAcb,GAAMa,EAAG,GAAKb,EAAE,IAAMa,EAAG,GAAKb,EAAE,IAAM,CAAEE,EAAEC,MAAQU,EAAG,GAAI,MAC9E,GAAc,IAAVA,EAAG,IAAYX,EAAEC,MAAQH,EAAE,GAAI,CAAEE,EAAEC,MAAQH,EAAE,GAAIA,EAAIa,EAAI,MAC7D,GAAIb,GAAKE,EAAEC,MAAQH,EAAE,GAAI,CAAEE,EAAEC,MAAQH,EAAE,GAAIE,EAAEI,IAAIY,KAAKL,GAAK,MACvDb,EAAE,IAAIE,EAAEI,IAAIU,MAChBd,EAAEG,KAAKW,MAAO,SAEtBH,EAAKhB,EAAKkB,KAAKpC,EAASuB,GAC1B,MAAOZ,GAAKuB,EAAK,CAAC,EAAGvB,GAAIS,EAAI,EAjBrB,QAiBoCD,EAAIE,EAAI,EACtD,GAAY,EAARa,EAAG,GAAQ,MAAMA,EAAG,GAAI,MAAO,CAAE1B,MAAO0B,EAAG,GAAKA,EAAG,QAAK,EAAQpB,MAAM,GArB9BL,CAAK,CAACuB,EAAGC,MAyB7D,IAAIO,EAAgB,OACpB,SAASC,EAAqBC,GAC1B,IAEIC,EAFAC,EAAoBF,EAAGE,kBAAmBC,EAAgBH,EAAGG,cAAeC,EAAoBJ,EAAGI,kBACnGC,EAAiB,IAAIC,kBA6FzB,SAASC,EAAqBC,GAC1BH,EAAeI,qBAAqBC,KAAKC,MAAMH,IAEnD,SAASI,EAAYC,GACbZ,GACAA,EAAgBa,KAAKD,GAG7B,OAnGAR,EAAeU,eAAiB,SAAU9C,GAClB,OAAhBA,EAAE+C,YACFC,QAAQC,IAAI,mBAAoBjD,GAChCgD,QAAQC,IAAI,mBAAoBR,KAAKS,UAAUd,EAAee,qBAGtEf,EAAegB,cAAgB,SAAUpD,GACrCgD,QAAQC,IAAI,gBAAiBjD,IAEjCoC,EAAeiB,wBAA0B,SAAUrD,GAC/CgD,QAAQC,IAAI,0BAA2BjD,IAE3CoC,EAAekB,oBAAsB,SAAUtD,GAC3CgD,QAAQC,IAAI,sBAAuBjD,IAEvCoC,EAAemB,2BAA6B,SAAUvD,GAClDgD,QAAQC,IAAI,6BAA8BjD,IAE9CoC,EAAeoB,0BAA4B,SAAUxD,GACjDgD,QAAQC,IAAI,4BAA6BjD,IAE7CoC,EAAeqB,oBAAsB,SAAUzD,GAC3CgD,QAAQC,IAAI,sBAAuBjD,IAEvCoC,EAAesB,uBAAyB,SAAU1D,GAC9CgD,QAAQC,IAAI,yBAA0BjD,IAE1CoC,EAAeuB,aAAe,SAAU3D,GACpCgD,QAAQC,IAAI,eAAgBjD,IAEhCoC,EAAewB,QAAU,SAAU5D,GAC/BgD,QAAQC,IAAI,UAAWjD,IAoEpB,IAAIP,SAAQ,SAAUoE,GACzBzB,EAAeU,eAAiB,SAAU9C,GAClB,OAAhBA,EAAE+C,WACFc,EAAI,CACAV,iBAAkBV,KAAKS,UAAUd,EAAee,kBAChDb,qBAAsBA,EACtBK,YAAaA,KAIpBV,GA9CLG,EAAegB,cAAgB,SAAUrB,GACrC,IAAI+B,EAAU/B,EAAG+B,SACjB9B,EAAkB8B,GACFC,OAAS,WACrB7B,KAEJF,EAAgBgC,UAAY,SAAUC,GAClC9B,EAAkB8B,EAAMC,QAIpC,SAAsBjC,GACX7C,EAAUgC,UAAM,OAAQ,GAAQ,WACnC,IAAI+C,EACJ,OAAO7D,EAAYc,MAAM,SAAUW,GAC/B,OAAQA,EAAGlB,OACP,KAAK,EAAG,MAAO,CAAC,EAAauB,EAAeI,qBAAqBC,KAAKC,MAAMT,KAC5E,KAAK,EAED,OADAF,EAAGjB,OACI,CAAC,EAAasB,EAAegC,gBACxC,KAAK,EAGD,OAFAD,EAAcpC,EAAGjB,OACjBsB,EAAeiC,oBAAoBF,GAC5B,CAAC,UA6BpBC,CAAanC,KAlFrB,WACI,KACID,EAAkBI,EAAekC,kBAAkBzC,IACnCkC,OAAS,WACrB7B,KAEJF,EAAgBgC,UAAY,SAAUC,GAClC9B,EAAkB8B,EAAMC,OAGhC,MAAOlE,GACHgD,QAAQuB,KAAK,mCAAoCvE,IAkEjDwE,GA/DR,WACWpF,EAAUgC,UAAM,OAAQ,GAAQ,WACnC,IAAI+C,EACJ,OAAO7D,EAAYc,MAAM,SAAUW,GAC/B,OAAQA,EAAGlB,OACP,KAAK,EAAG,MAAO,CAAC,EAAauB,EAAeqC,eAC5C,KAAK,EAID,OAHAN,EAAcpC,EAAGjB,OACjBkC,QAAQC,IAAI,cAAekB,GAC3B/B,EAAeiC,oBAAoBF,GAC5B,CAAC,UAsDpBM,O,ICzKAC,E,iZAAAA,K,QAAAA,E,qBAAAA,M,KCYZ,ICZYC,EDYNC,EAAYC,IAAOC,KAAV,KACTC,EAAUF,IAAOG,IAAV,KACT,qBAAGC,SAAwBP,EAAeQ,GAAKC,YAA/B,KAEd,MAEAC,EAAkBP,IAAOG,IAAV,KACfK,EAAUR,IAAOG,IAAV,KAEAM,EAA4B,SAAC,GAA+B,IAA7BC,EAA4B,EAA5BA,SAAU5C,EAAkB,EAAlBA,YAAkB,EAC5B6C,IAAMC,SAAiB,IADK,mBAC/DC,EAD+D,KAChDC,EADgD,KAgBtE,OACE,kBAACN,EAAD,KACE,kBAACD,EAAD,KACGG,EAASK,KAAI,SAAAhD,GAAO,OACnB,kBAACmC,EAAD,CAASc,IAAKjD,EAAQkD,GAAIb,OAAQrC,EAAQqC,QAASrC,EAAQmD,aAG/D,kBAACnB,EAAD,CAAWoB,SAd+C,SAAC/B,GAC7DA,EAAMgC,iBACNhC,EAAMiC,kBACNvD,EAAY+C,GACZC,EAAiB,MAWb,kBAAC,IAAD,CAAOQ,KAAK,OAAOC,YAAY,aAAavG,MAAO6F,EAAeW,SArBW,SAACpC,GAClFA,EAAMgC,iBACNhC,EAAMiC,kBACNP,EAAiB1B,EAAMqC,OAAOzG,a,sGC3BtB8E,K,aAAAA,M,KCGL,ICgBF4B,EDhBQC,EAAQ3B,IAAOG,IAAV,KACD,gBAAGyB,EAAH,EAAGA,KAAH,gBAAiBA,EAAjB,S,6tBCeZF,K,YAAAA,E,eAAAA,M,KAKL,IAAMlB,EAAUR,IAAOG,IAAV,KAoIE0B,EA9HO,WAAO,IAAD,EACFlB,IAAMC,WADJ,mBACnBkB,EADmB,KACbC,EADa,OAEIpB,IAAMC,UAAkB,GAF5B,mBAEnBoB,EAFmB,KAEVC,EAFU,OAGsBtB,IAAMC,WAH5B,mBAGnBtC,EAHmB,KAGDkB,EAHC,OAIwBmB,IAAMC,SAAiB,IAJ/C,mBAInBxD,EAJmB,KAIAO,EAJA,OAKMgD,IAAMC,SAAwB,IALpC,mBAKnBF,EALmB,KAKTwB,EALS,KAMpBC,EAA0BxB,IAAMyB,SAChCC,EAAiB1B,IAAMyB,SAEvB9E,EAAoB,SAACgF,GACzB,IACE,IAAMvE,EAAUH,KAAKC,MAAMyE,GAC3BJ,GAAY,SAACxB,GAAD,4BAAkBA,GAAlB,CAA4B3C,OACxC,YAGEV,EAAgB,kBAAM4E,GAAW,IAEjCM,EAAkB,uCAAG,kCAAAC,EAAA,6DACzBT,EAAQL,EAAKe,MADY,SAE6CxF,EAAqB,CAAEK,oBAAmBD,kBAFvF,gBAEjBiB,EAFiB,EAEjBA,iBAAkBb,EAFD,EAECA,qBAAsBK,EAFvB,EAEuBA,YAChDuE,EAAeK,QAAU5E,EACzBqE,EAAwBO,QAAUjF,EAClC+B,EAAoBmD,SAAOC,OAAOtE,IALT,4CAAH,qDAclBuE,EAAiF,SAACzD,GACtFzB,EAAqByB,EAAMqC,OAAOzG,QAG9B8H,EAAmB,uCAAG,gCAAAN,EAAA,0DACtBpF,EADsB,uBAExB2E,EAAQL,EAAKqB,OAFW,SAGwB9F,EAAqB,CAAEG,kBAAmBuF,SAAOK,OAAO5F,GAAoBE,oBAAmBD,kBAHvH,gBAGhBiB,EAHgB,EAGhBA,iBAAkBR,EAHF,EAGEA,YAC1BuE,EAAeK,QAAU5E,EACzB0B,EAAoBmD,SAAOC,OAAOtE,IALV,2CAAH,qDASnB2E,EAA6B,WACjC3E,GAAoB4E,IAAK5E,IAoBrB6E,EAAezC,EAAS0C,QAAO,SAAAC,GAAC,OAAIA,EAAE/B,OAASxB,EAAawD,QAElE,OACE,kBAAC,EAAD,KACE,kBAAC,IAAWC,MAAZ,CAAkBC,MAAO,CAAEC,UAAW,WAAtC,aACE3B,GACA,6BACE,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAQ4B,QAASnB,EAAoBjB,KAAK,UAAUqC,OAAK,GAAzD,aAEF,kBAAChC,EAAD,CAAOC,KAAM,KACb,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAON,KAAK,OAAOtG,MAAOoC,EAAmBoE,SAAUqB,EAAoCtB,YAAY,kCACvG,kBAACI,EAAD,CAAOC,KAAM,KACb,kBAAC,IAAD,CAAQ8B,QAASZ,EAAqBxB,KAAK,UAAUqC,OAAK,GAA1D,iBAIL7B,IAASJ,EAAKe,OAAST,GACtB,6BACE,kBAAC,IAAW4B,KAAZ,wCACA,kBAACjC,EAAD,CAAOC,KAAM,IACb,kBAAC,IAAMiC,OAAP,CACEvC,KAAK,OACLtG,MAAOsD,GAAsC,0BAC7CwF,YAAY,oBACZC,SAAUd,IAEZ,kBAACtB,EAAD,CAAOC,KAAM,KACb,kBAAC,IAAWgC,KAAZ,8BACA,kBAACjC,EAAD,CAAOC,KAAM,IACb,kBAAC,IAAMiC,OAAP,CACEvC,KAAK,OACLtG,MAAOoC,EACPoE,SAAUqB,EACVtB,YAAY,uBACZuC,YAAY,UACZC,SA7EmB,WACvB3G,GAAqB+E,EAAwBO,SAC/CP,EAAwBO,QAAQC,SAAOK,OAAO5F,QA+E7C0E,IAASJ,EAAKqB,QAAUf,GACvB,6BACE,kBAAC,IAAW4B,KAAZ,wCACA,kBAACjC,EAAD,CAAOC,KAAM,IACb,kBAAC,IAAMiC,OAAP,CACEvC,KAAK,OACLtG,MAAOsD,GAAsC,0BAC7CwF,YAAY,oBACZC,SAAUd,KAIfnB,GAAQE,GACP,kBAAC,EAAD,CAAMtB,SAAUyC,EAAcrF,YAvEN,SAAC+C,GAC7B,GAAIwB,EAAeK,QAAS,CAC1B,IAAM3E,EAAuB,CAC3BkD,GAAI+C,KAAKC,SAASC,QAAQ,IAC1B9D,OAAQP,EAAesE,SACvB7C,KAAMxB,EAAawD,KACnBpC,QAASL,GAGXwB,EAAeK,QAAQ9E,KAAKS,UAAUN,IACtCmE,GAAY,SAACxB,GAAD,4BAAkBA,GAAlB,MACP3C,EADO,CAEVqC,OAAQP,EAAeQ,gBC/EX+D,QACW,cAA7BC,OAAOC,SAASC,UAEe,UAA7BF,OAAOC,SAASC,UAEhBF,OAAOC,SAASC,SAASC,MACvB,2DCZNC,IAASC,OAAO,kBAAC,EAAD,MAASC,SAASC,eAAe,SD2H3C,kBAAmBC,WACrBA,UAAUC,cAAcC,MAAMxJ,MAAK,SAAAyJ,GACjCA,EAAaC,kB","file":"static/js/main.91fbe544.chunk.js","sourcesContent":["/* eslint-disable */\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\n\nvar CHANNEL_LABEL = 'test';\r\nfunction createPeerConnection(_a) {\r\n    var remoteDescription = _a.remoteDescription, onChannelOpen = _a.onChannelOpen, onMessageReceived = _a.onMessageReceived;\r\n    var peerConnection = new RTCPeerConnection();\r\n    var channelInstance;\r\n    peerConnection.onicecandidate = function (e) {\r\n        if (e.candidate === null) {\r\n            console.log('onicecandidate 1', e);\r\n            console.log('onicecandidate 2', JSON.stringify(peerConnection.localDescription));\r\n        }\r\n    };\r\n    peerConnection.ondatachannel = function (e) {\r\n        console.log('ondatachannel', e);\r\n    };\r\n    peerConnection.onconnectionstatechange = function (e) {\r\n        console.log('onconnectionstatechange', e);\r\n    };\r\n    peerConnection.onicecandidateerror = function (e) {\r\n        console.log('onicecandidateerror', e);\r\n    };\r\n    peerConnection.oniceconnectionstatechange = function (e) {\r\n        console.log('oniceconnectionstatechange', e);\r\n    };\r\n    peerConnection.onicegatheringstatechange = function (e) {\r\n        console.log('onicegatheringstatechange', e);\r\n    };\r\n    peerConnection.onnegotiationneeded = function (e) {\r\n        console.log('onnegotiationneeded', e);\r\n    };\r\n    peerConnection.onsignalingstatechange = function (e) {\r\n        console.log('onsignalingstatechange', e);\r\n    };\r\n    peerConnection.onstatsended = function (e) {\r\n        console.log('onstatsended', e);\r\n    };\r\n    peerConnection.ontrack = function (e) {\r\n        console.log('ontrack', e);\r\n    };\r\n    function setupDC1() {\r\n        try {\r\n            channelInstance = peerConnection.createDataChannel(CHANNEL_LABEL);\r\n            channelInstance.onopen = function () {\r\n                onChannelOpen();\r\n            };\r\n            channelInstance.onmessage = function (event) {\r\n                onMessageReceived(event.data);\r\n            };\r\n        }\r\n        catch (e) {\r\n            console.warn('No data channel (peerConnection)', e);\r\n        }\r\n    }\r\n    function createOffer() {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var description;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, peerConnection.createOffer()];\r\n                    case 1:\r\n                        description = _a.sent();\r\n                        console.log('description', description);\r\n                        peerConnection.setLocalDescription(description);\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    }\r\n    function setupDC2() {\r\n        peerConnection.ondatachannel = function (_a) {\r\n            var channel = _a.channel;\r\n            channelInstance = channel;\r\n            channelInstance.onopen = function () {\r\n                onChannelOpen();\r\n            };\r\n            channelInstance.onmessage = function (event) {\r\n                onMessageReceived(event.data);\r\n            };\r\n        };\r\n    }\r\n    function createAnswer(remoteDescription) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var description;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, peerConnection.setRemoteDescription(JSON.parse(remoteDescription))];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, peerConnection.createAnswer()];\r\n                    case 2:\r\n                        description = _a.sent();\r\n                        peerConnection.setLocalDescription(description);\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    }\r\n    function setAnswerDescription(answerDescription) {\r\n        peerConnection.setRemoteDescription(JSON.parse(answerDescription));\r\n    }\r\n    function sendMessage(message) {\r\n        if (channelInstance) {\r\n            channelInstance.send(message);\r\n        }\r\n    }\r\n    return new Promise(function (res) {\r\n        peerConnection.onicecandidate = function (e) {\r\n            if (e.candidate === null) {\r\n                res({\r\n                    localDescription: JSON.stringify(peerConnection.localDescription),\r\n                    setAnswerDescription: setAnswerDescription,\r\n                    sendMessage: sendMessage,\r\n                });\r\n            }\r\n        };\r\n        if (!remoteDescription) {\r\n            setupDC1();\r\n            createOffer();\r\n        }\r\n        else {\r\n            setupDC2();\r\n            createAnswer(remoteDescription);\r\n        }\r\n    });\r\n}\r\n// /* THIS IS BOB, THE ANSWERER/RECEIVER */\r\n// var pc2 = new RTCPeerConnection(cfg, con),\r\n//   dc2 = null\r\n// var pc2icedone = false\r\n// pc2.ondatachannel = function (e) {\r\n//   var fileReceiver2 = new FileReceiver()\r\n//   var datachannel = e.channel || e; // Chrome sends event, FF sends raw channel\r\n//   console.log('Received datachannel (pc2)', arguments)\r\n//   dc2 = datachannel\r\n//   activedc = dc2\r\n//   dc2.onopen = function (e) {\r\n//     console.log('data channel connect')\r\n//     $('#waitForConnection').modal('hide')\r\n//     $('#waitForConnection').remove()\r\n//   }\r\n//   dc2.onmessage = function (e) {\r\n//     console.log('Got message (pc2)', e.data)\r\n//     if (e.data.size) {\r\n//       fileReceiver2.receive(e.data, {})\r\n//     } else {\r\n//       var data = JSON.parse(e.data)\r\n//       if (data.type === 'file') {\r\n//         fileReceiver2.receive(e.data, {})\r\n//       } else {\r\n//         writeToChatLog(data.message, 'text-info')\r\n//         // Scroll chat text area to the bottom on new input.\r\n//         $('#chatlog').scrollTop($('#chatlog')[0].scrollHeight)\r\n//       }\r\n//     }\r\n//   }\r\n// }\r\n// function handleOfferFromPC1 (offerDesc) {\r\n//   pc2.setRemoteDescription(offerDesc)\r\n//   pc2.createAnswer(function (answerDesc) {\r\n//     writeToChatLog('Created local answer', 'text-success')\r\n//     console.log('Created local answer: ', answerDesc)\r\n//     pc2.setLocalDescription(answerDesc)\r\n//   },\r\n//   function () { console.warn(\"Couldn't create offer\") },\r\n//   sdpConstraints)\r\n// }\r\n// pc2.onicecandidate = function (e) {\r\n//   console.log('ICE candidate (pc2)', e)\r\n//   if (e.candidate == null) {\r\n//     $('#localAnswer').html(JSON.stringify(pc2.localDescription))\r\n//   }\r\n// }\r\n// pc2.onsignalingstatechange = onsignalingstatechange\r\n// pc2.oniceconnectionstatechange = oniceconnectionstatechange\r\n// pc2.onicegatheringstatechange = onicegatheringstatechange\r\n// function handleCandidateFromPC1 (iceCandidate) {\r\n//   pc2.addIceCandidate(iceCandidate)\r\n// }\r\n// pc2.onaddstream = handleOnaddstream\r\n// pc2.onconnection = handleOnconnection\r\n// function getTimestamp () {\r\n//   var totalSec = new Date().getTime() / 1000\r\n//   var hours = parseInt(totalSec / 3600) % 24\r\n//   var minutes = parseInt(totalSec / 60) % 60\r\n//   var seconds = parseInt(totalSec % 60)\r\n//   var result = (hours < 10 ? '0' + hours : hours) + ':' +\r\n//     (minutes < 10 ? '0' + minutes : minutes) + ':' +\r\n//     (seconds < 10 ? '0' + seconds : seconds)\r\n//   return result\r\n// }\r\n// function writeToChatLog (message, message_type) {\r\n//   document.getElementById('chatlog').innerHTML += '<p class=\"' + message_type + '\">' + '[' + getTimestamp() + '] ' + message + '</p>'\r\n// }\n\nexport { createPeerConnection };\n","export enum MESSAGE_SENDER {\n  ME = 'ME',\n  STRANGER = 'STRANGER',\n};\n","import React from 'react';\nimport { Input } from 'antd';\nimport 'antd/es/input/style/css';\nimport styled, { css } from 'styled-components';\nimport { TextMessageType } from '../../types/TextMessageType';\nimport { MESSAGE_SENDER } from '../../types/MessageSenderEnum';\n\nexport interface ChatProps {\n  messages: TextMessageType[];\n  sendMessage: (message: string) => any;\n};\n\nconst InputForm = styled.form``;\nconst Message = styled.div<{ sender: MESSAGE_SENDER }>`\n  ${({ sender }) => sender === MESSAGE_SENDER.ME ? css`\n    text-align: right;\n  ` : ''};\n`;\nconst MessagesWrapper = styled.div``;\nconst Wrapper = styled.div``;\n\nexport const Chat: React.FC<ChatProps> = ({ messages, sendMessage }) => {\n  const [messageToSend, setMessageToSend] = React.useState<string>('');\n\n  const handleMessageToSendInputChange: React.ChangeEventHandler<HTMLInputElement> = (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n    setMessageToSend(event.target.value);\n  }\n\n  const handleMessageToSendFormSubmit: React.FormEventHandler = (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n    sendMessage(messageToSend);\n    setMessageToSend('');\n  }\n\n  return (\n    <Wrapper>\n      <MessagesWrapper>\n        {messages.map(message =>\n          <Message key={message.id} sender={message.sender}>{message.payload}</Message>  \n        )}\n      </MessagesWrapper>\n      <InputForm onSubmit={handleMessageToSendFormSubmit}>\n        <Input type=\"text\" placeholder=\"Message...\" value={messageToSend} onChange={handleMessageToSendInputChange} />\n      </InputForm>\n    </Wrapper>\n  );\n}\n","export enum MESSAGE_TYPE {\n  TEXT = 'TEXT',\n};\n","import React from 'react';\nimport styled from 'styled-components';\n\nexport const Space = styled.div<{ size: number }>`\n  padding-top: ${({ size }) => `${size}px`};\n`;\n","import React from 'react';\nimport { Input } from 'antd';\nimport 'antd/es/input/style/css';\nimport { Card } from 'antd';\nimport 'antd/es/card/style/css';\nimport { Button } from 'antd';\nimport 'antd/es/button/style/css';\nimport { Typography } from 'antd';\nimport 'antd/es/typography/style/css';\nimport { createPeerConnection } from './typescript-lib';\nimport { Chat } from './components/Chat/Chat';\nimport { MessageType } from './types/MessageType';\nimport { MESSAGE_SENDER } from './types/MessageSenderEnum';\nimport { MESSAGE_TYPE } from './types/MessageTypeEnum';\nimport { Space } from './components/Space/Space';\nimport styled from 'styled-components';\nimport { Base64 } from 'js-base64';\nimport copy from 'copy-to-clipboard';\n\nenum Mode {\n  HOST = 'HOST',\n  SLAVE = 'SLAVE',\n};\n\nconst Wrapper = styled.div`\n  padding: 12px;\n  max-width: 400px;\n  margin: 0 auto;\n`;\n\nconst App: React.FC = () => {\n  const [mode, setMode] = React.useState<Mode | undefined>();\n  const [isReady, setIsReady] = React.useState<boolean>(false);\n  const [localDescription, setLocalDescription] = React.useState<string | undefined>();\n  const [remoteDescription, setRemoteDescription] = React.useState<string>('');\n  const [messages, setMessages] = React.useState<MessageType[]>([]);\n  const setAnswerDescriptionRef = React.useRef<((answerDescription: string) => void) | undefined>();\n  const sendMessageRef = React.useRef<((message: string) => void) | undefined>();\n\n  const onMessageReceived = (messageString: string) => {\n    try {\n      const message = JSON.parse(messageString) as MessageType;\n      setMessages((messages) => [...messages, message]);\n    } catch {}\n  }\n\n  const onChannelOpen = () => setIsReady(true);\n\n  const handleHostBtnClick = async () => {\n    setMode(Mode.HOST);\n    const { localDescription, setAnswerDescription, sendMessage } = await createPeerConnection({ onMessageReceived, onChannelOpen });\n    sendMessageRef.current = sendMessage;\n    setAnswerDescriptionRef.current = setAnswerDescription;\n    setLocalDescription(Base64.encode(localDescription));\n  }\n\n  const handleAnswerBtnClick = () => {\n    if (remoteDescription && setAnswerDescriptionRef.current) {\n      setAnswerDescriptionRef.current(Base64.decode(remoteDescription));\n    }\n  }\n\n  const handleRemoteDescriptionInputChange: React.ChangeEventHandler<HTMLInputElement> = (event) => {\n    setRemoteDescription(event.target.value);\n  }\n\n  const handleSlaveBtnClick = async () => {\n    if (remoteDescription) {\n      setMode(Mode.SLAVE);\n      const { localDescription, sendMessage } = await createPeerConnection({ remoteDescription: Base64.decode(remoteDescription), onMessageReceived, onChannelOpen });\n      sendMessageRef.current = sendMessage;\n      setLocalDescription(Base64.encode(localDescription));\n    }\n  }\n\n  const handleLocalDescriptionCopy = () => {\n    localDescription && copy(localDescription);\n  }\n\n  const handleChatSendMessage = (messageToSend: string) => {\n    if (sendMessageRef.current) {\n      const message: MessageType = {\n        id: Math.random().toFixed(10),\n        sender: MESSAGE_SENDER.STRANGER,\n        type: MESSAGE_TYPE.TEXT,\n        payload: messageToSend,\n      };\n\n      sendMessageRef.current(JSON.stringify(message));\n      setMessages((messages) => [...messages, {\n        ...message,\n        sender: MESSAGE_SENDER.ME,\n      }])\n    }\n  }\n\n  const textMessages = messages.filter(m => m.type === MESSAGE_TYPE.TEXT);\n  \n  return (\n    <Wrapper>\n      <Typography.Title style={{ textAlign: 'center' }}>p2p chat</Typography.Title>\n      {!mode &&\n        <div>\n          <Card>\n            <Button onClick={handleHostBtnClick} type=\"primary\" block>New chat</Button>\n          </Card>\n          <Space size={24} />\n          <Card>\n            <Input type=\"text\" value={remoteDescription} onChange={handleRemoteDescriptionInputChange} placeholder=\"Paste connection code here...\" />\n            <Space size={12} />\n            <Button onClick={handleSlaveBtnClick} type=\"primary\" block>Join a chat</Button>\n          </Card>\n        </div>\n      }\n      {mode === Mode.HOST && !isReady &&\n        <div>\n          <Typography.Text>Send this code to other person:</Typography.Text>\n          <Space size={4} />\n          <Input.Search\n            type=\"text\"\n            value={localDescription ? localDescription : 'preparing connection...'}\n            enterButton=\"Copy to clipboard\"\n            onSearch={handleLocalDescriptionCopy}\n          />\n          <Space size={24} />\n          <Typography.Text>Code from your buddy:</Typography.Text>\n          <Space size={4} />\n          <Input.Search\n            type=\"text\"\n            value={remoteDescription}\n            onChange={handleRemoteDescriptionInputChange}\n            placeholder=\"Paste an answer code\"\n            enterButton=\"Connect\"\n            onSearch={handleAnswerBtnClick}\n          />\n        </div>\n      }\n      {mode === Mode.SLAVE && !isReady &&\n        <div>\n          <Typography.Text>Send this code to other person:</Typography.Text>\n          <Space size={4} />\n          <Input.Search\n            type=\"text\"\n            value={localDescription ? localDescription : 'preparing connection...'}\n            enterButton=\"Copy to clipboard\"\n            onSearch={handleLocalDescriptionCopy}\n          />\n        </div>\n      }\n      {mode && isReady &&\n        <Chat messages={textMessages} sendMessage={handleChatSendMessage} />\n      }\n    </Wrapper>\n  );\n};\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}